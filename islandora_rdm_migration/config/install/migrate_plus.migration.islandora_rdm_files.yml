langcode: en
status: true
dependencies:
  enforced:
    module:
      - migrate_7x_claw
      - migrate_plus
      - islandora_rdm
id: islandora_rdm_files
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags: null
migration_group: islandora_7x_rdm
label: 'Islandora RDM Files'
source:
  plugin: islandora
  solr_base_url: 'http://10.0.2.2:8080/solr'
  q: 'fedora_datastreams_ms:DDI AND PID:researchdata\:*'
  fedora_base_url: 'http://10.0.2.2:8080/fedora'
  islandora_type: datastreams
  datastream_solr_field: fedora_datastreams_ms
  data_fetcher_plugin: http
  authentication:
    plugin: basic
    username: fedoraAdmin
    password: fedoraAdmin
  data_parser_plugin: tuque_datastreams
  item_selector: '/foxml:digitalObject'
  constants:
    fedora_base_url: 'http://10.0.2.2:8080/fedora'
    destination_directory: 'fedora://'
    extension: jpg
    objects_string: objects
    datastreams_string: datastreams
    content_string: content
    obj_contents_suffix: datastreams/OBJ/content
    creator_uid: 1
  fields:
    -
      name: PID
      label: PID
      selector: ID
    -
      name: mimetype
      label: Mimetype
      selector: mimetype
    -
      name: DSID
      label: 'Datastream ID'
      selector: DSID
  ids:
    PID_DSID:
      type: string
process:
  type:
    plugin: default_value
    default_value: file
  digital_id:
    plugin: str_replace
    source: PID_DSID
    search: ':'
    replace: _
  remote_path:
    plugin: concat
    delimiter: /
    source:
      - constants/fedora_base_url
      - constants/objects_string
      - PID
      - constants/datastreams_string
      - DSID
      - constants/content_string
  extension:
    plugin: static_map_dots
    source: mimetype
    map:
      application/acad: dwg
      application/arj: arj
      application/base64: mm
      application/binhex4: hqx
      application/binhex: hqx
      application/book: book
      application/cdf: cdf
      application/clariscad: ccad
      application/commonground: dp
      application/drafting: drw
      application/dsptype: tsp
      application/dxf: dxf
      application/ecmascript: js
      application/envoy: evy
      application/excel: xls
      application/fractals: fif
      application/freeloader: frl
      application/futuresplash: spl
      application/gnutar: tgz
      application/groupwise: vew
      application/hlp: hlp
      application/hta: hta
      application/i-deas: unv
      application/iges: iges
      application/inf: inf
      application/java-byte-code: class
      application/java: class
      application/javascript: js
      application/lha: lha
      application/lzx: lzx
      application/mac-binary: bin
      application/mac-binhex40: hqx
      application/mac-binhex: hqx
      application/mac-compactpro: cpt
      application/macbinary: bin
      application/marc: mrc
      application/mbedlet: mbd
      application/mcad: mcd
      application/mime: aps
      application/mspowerpoint: ppt
      application/msword: doc
      application/mswrite: wri
      application/netmc: mcp
      application/octet-stream: bin
      application/oda: oda
      application/pdf: pdf
      application/pkcs-12: p12
      application/pkcs-crl: crl
      application/pkcs10: p10
      application/pkcs7-mime: p7c
      application/pkix-cert: cer
      application/plain: text
      application/postscript: ps
      application/powerpoint: ppt
      application/pro_eng: part
      application/rdf+xml: xml
      application/ringing-tones: rng
      application/rtf: rtf
      application/sdp: sdp
      application/sea: sea
      application/set: set
      application/sla: stl
      application/smil: smil
      application/solids: sol
      application/sounder: sdr
      application/step: step
      application/streamingmedia: ssm
      application/toolbook: tbk
      application/vda: vda
      application/vocaltec-media-desc: vmd
      application/vocaltec-media-file: vmf
      application/wordperfect: wpd
      application/x-123: wk1
      application/x-aim: aim
      application/x-authorware-bin: aab
      application/x-authorware-map: aam
      application/x-authorware-seg: aas
      application/x-bcpio: bcpio
      application/x-binary: bin
      application/x-binhex40: hqx
      application/x-bsh: bsh
      application/x-bzip2: bz2
      application/x-bzip: bz
      application/x-cdf: cdf
      application/x-cdlink: vcd
      application/x-chat: chat
      application/x-cmu-raster: ras
      application/x-cocoa: cco
      application/x-compactpro: cpt
      application/x-compress: z
      application/x-compressed: zip
      application/x-conference: nsc
      application/x-cpio: cpio
      application/x-cpt: cpt
      application/x-csh: csh
      application/x-deepv: deepv
      application/x-director: dcr
      application/x-dvi: dvi
      application/x-elc: elc
      application/x-envoy: env
      application/x-esrehber: es
      application/x-excel: xls
      application/x-frame: mif
      application/x-freelance: pre
      application/x-gsp: gsp
      application/x-gss: gss
      application/x-gtar: gtar
      application/x-gzip: gz
      application/x-hdf: hdf
      application/x-helpfile: hlp
      application/x-httpd-imap: imap
      application/x-ima: ima
      application/x-internett-signup: ins
      application/x-inventor: iv
      application/x-ip2: ip
      application/x-java-class: class
      application/x-java-commerce: jcm
      application/x-javascript: js
      application/x-koan: skd
      application/x-ksh: ksh
      application/x-latex: latex
      application/x-lha: lha
      application/x-lisp: lsp
      application/x-livescreen: ivy
      application/x-lotus: wq1
      application/x-lotusscreencam: scm
      application/x-lzh: lzh
      application/x-lzx: lzx
      application/x-mac-binhex40: hqx
      application/x-macbinary: bin
      application/x-mathcad: mcd
      application/x-meme: mm
      application/x-midi: mid
      application/x-mif: mif
      application/x-mix-transfer: nix
      application/x-mplayer2: asx
      application/x-msexcel: xls
      application/x-mspowerpoint: ppt
      application/x-navi-animation: ani
      application/x-navidoc: nvd
      application/x-navimap: map
      application/x-navistyle: stl
      application/x-netcdf: cdf
      application/x-newton-compatible-pkg: pkg
      application/x-nokia-9000-communicator-add-on-software: aos
      application/x-omc: omc
      application/x-omcdatamaker: omcd
      application/x-omcregerator: omcr
      application/x-pagemaker: pm5
      application/x-pcl: pcl
      application/x-pixclscript: plx
      application/x-pkcs10: p10
      application/x-pkcs12: p12
      application/x-pkcs7-certificates: spc
      application/x-pkcs7-certreqresp: p7r
      application/x-pkcs7-mime: p7m
      application/x-pkcs7-signature: p7a
      application/x-pointplus: css
      application/x-portable-anymap: pnm
      application/x-project: mpx
      application/x-qpro: wb1
      application/x-rtf: rtf
      application/x-sdp: sdp
      application/x-sea: sea
      application/x-seelogo: sl
      application/x-sh: sh
      application/x-shar: shar
      application/x-shockwave-flash: swf
      application/x-sit: sit
      application/x-sprite: spr
      application/x-stuffit: sit
      application/x-sv4cpio: sv4cpio
      application/x-sv4crc: sv4crc
      application/x-tar: tar
      application/x-tbook: tbk
      application/x-tcl: tcl
      application/x-tex: tex
      application/x-texinfo: texinfo
      application/x-troff-man: man
      application/x-troff-me: me
      application/x-troff-ms: ms
      application/x-troff-msvideo: avi
      application/x-troff: roff
      application/x-ustar: ustar
      application/x-visio: vsw
      application/x-vrml: vrml
      application/x-wais-source: wsrc
      application/x-winhelp: hlp
      application/x-wintalk: wtk
      application/x-world: wrl
      application/x-wpwin: wpd
      application/x-wri: wri
      application/x-x509-ca-cert: crt
      application/x-x509-user-cert: crt
      application/x-zip-compressed: zip
      application/xml: xml
      application/zip: zip
      audio/aac: aac
      audio/aiff: aiff
      audio/basic: au
      audio/it: it
      audio/make: funk
      audio/mid: rmi
      audio/midi: midi
      audio/mod: mod
      audio/mpeg3: mp3
      audio/mpeg: mp2
      audio/nspaudio: la
      audio/s3m: s3m
      audio/tsp-audio: tsi
      audio/tsplayer: tsp
      audio/voc: voc
      audio/voxware: vox
      audio/wav: wav
      audio/x-adpcm: snd
      audio/x-aiff: aiff
      audio/x-au: au
      audio/x-gsm: gsm
      audio/x-jam: jam
      audio/x-liveaudio: lam
      audio/x-mid: midi
      audio/x-midi: midi
      audio/x-mod: mod
      audio/x-mpeg-3: mp3
      audio/x-mpeg: mp2
      audio/x-mpequrl: m3u
      audio/x-nspaudio: la
      audio/x-pn-realaudio-plugin: rmp
      audio/x-pn-realaudio: ra
      audio/x-psid: sid
      audio/x-realaudio: ra
      audio/x-twinvq-plugin: vqe
      audio/x-twinvq: vqf
      audio/x-voc: voc
      audio/x-wav: wav
      audio/xm: xm
      chemical/x-pdb: pdb
      drawing/x-dwf (old): dwf
      i-world/i-vrml: ivr
      image/bmp: bmp
      image/cmu-raster: rast
      image/fif: fif
      image/florian: flo
      image/g3fax: g3
      image/gif: gif
      image/ief: ief
      image/jp2: jp2
      image/jpeg: jpg
      image/jpg: jpg
      image/jutvision: jut
      image/naplps: nap
      image/pict: pict
      image/pjpeg: jpg
      image/png: png
      image/tif: tiff
      image/tiff: tiff
      image/vasa: mcf
      image/x-cmu-raster: ras
      image/x-dwg: dwg
      image/x-icon: ico
      image/x-jg: art
      image/x-jps: jps
      image/x-niff: niff
      image/x-pcx: pcx
      image/x-pict: pct
      image/x-portable-anymap: pnm
      image/x-portable-bitmap: pbm
      image/x-portable-graymap: pgm
      image/x-portable-greymap: pgm
      image/x-portable-pixmap: ppm
      image/x-quicktime: qtif
      image/x-rgb: rgb
      image/x-tiff: tiff
      image/x-windows-bmp: bmp
      image/x-xbitmap: xbm
      image/x-xbm: xbm
      image/x-xpixmap: xpm
      image/x-xwd: xwd
      image/x-xwindowdump: xwd
      image/xbm: xbm
      image/xpm: xpm
      message/rfc822: mime
      model/iges: iges
      model/vrml: vrml
      model/x-pov: pov
      multipart/x-gzip: gzip
      multipart/x-ustar: ustar
      multipart/x-zip: zip
      music/crescendo: mid
      music/x-karaoke: kar
      paleovu/x-pv: pvu
      text/asp: asp
      text/css: css
      text/ecmascript: js
      text/html: html
      text/javascript: js
      text/mcf: mcf
      text/pascal: pas
      text/plain: txt
      text/richtext: rtf
      text/scriplet: wsc
      text/sgml: sgml
      text/tab-separated-values: tsv
      text/uri-list: uni
      text/webviewhtml: htt
      text/x-asm: asm
      text/x-audiosoft-intra: aip
      text/x-c: cpp
      text/x-component: htc
      text/x-fortran: f
      text/x-h: h
      text/x-java-source: java
      text/x-la-asf: lsx
      text/x-m: m
      text/x-pascal: p
      text/x-script: hlb
      text/x-server-parsed-html: shtml
      text/x-setext: etx
      text/x-sgml: sgml
      text/x-speech: talk
      text/x-uil: uil
      text/x-uuencode: uu
      text/x-vcalendar: vcs
      text/xml: xml
      video/animaflex: afl
      video/avi: avi
      video/avs-video: avs
      video/dl: dl
      video/fli: fli
      video/gl: gl
      video/mp4: mp4
      video/mpeg: mpg
      video/msvideo: avi
      video/quicktime: mov
      video/vdo: vdo
      video/vivo: viv
      video/vosaic: vos
      video/x-amt-demorun: xdr
      video/x-amt-showrun: xsr
      video/x-atomic3d-feature: fmf
      video/x-dl: dl
      video/x-dv: dv
      video/x-fli: fli
      video/x-gl: gl
      video/x-isvideo: isu
      video/x-matroska: mkv
      video/x-motion-jpeg: mjpg
      video/x-ms-asf-plugin: asx
      video/x-ms-asf: asf
      video/x-msvideo: avi
      video/x-qtc: qtc
      video/x-scm: scm
      video/x-sgi-movie: mv
      windows/metafile: wmf
      www/mime: mime
      x-conference/x-cooltalk: ice
      x-music/x-midi: mid
      x-world/x-svr: svr
      x-world/x-vrml: vrml
      x-world/x-vrt: vrt
      xgl/drawing: xgz
      xgl/movie: xmz
      text/txt: txt
      application/vnd&#46;ms-excel&#46;addin&#46;macroEnabled&#46;12: xlam
      application/vnd&#46;ms-excel&#46;sheet&#46;binary&#46;macroEnabled&#46;12: xlsb
      application/vnd&#46;ms-excel&#46;sheet&#46;macroEnabled&#46;12: xlsm
      application/vnd&#46;ms-excel&#46;template&#46;macroEnabled&#46;12: xltm
      application/vnd&#46;ms-excel: xls
      application/vnd&#46;ms-powerpoint&#46;addin&#46;macroEnabled&#46;12: ppam
      application/vnd&#46;ms-powerpoint&#46;presentation&#46;macroEnabled&#46;12: pptm
      application/vnd&#46;ms-powerpoint&#46;slideshow&#46;macroEnabled&#46;12: ppsm
      application/vnd&#46;ms-powerpoint&#46;template&#46;macroEnabled&#46;12: potm
      application/vnd&#46;ms-powerpoint: pot
      application/vnd&#46;ms-word&#46;document&#46;macroEnabled&#46;12: docm
      application/vnd&#46;ms-word&#46;template&#46;macroEnabled&#46;12: dotm
      application/vnd&#46;openxmlformats-officedocument&#46;presentationml&#46;presentation: pptx
      application/vnd&#46;openxmlformats-officedocument&#46;presentationml&#46;slideshow: ppsx
      application/vnd&#46;openxmlformats-officedocument&#46;presentationml&#46;template: potx
      application/vnd&#46;openxmlformats-officedocument&#46;spreadsheetml&#46;sheet: xlsx
      application/vnd&#46;openxmlformats-officedocument&#46;spreadsheetml&#46;template: xltx
      application/vnd&#46;openxmlformats-officedocument&#46;wordprocessingml&#46;document: docx
      application/vnd&#46;openxmlformats-officedocument&#46;wordprocessingml&#46;template: dotx
  filename:
    plugin: concat
    delimiter: .
    source:
      - '@digital_id'
      - '@extension'
  local_path:
    plugin: concat
    delimiter: /
    source:
      - constants/destination_directory
      - '@filename'
  uri:
    plugin: download
    source:
      - '@remote_path'
      - '@local_path'
    guzzle_options:
      auth:
        - fedoraAdmin
        - fedoraAdmin
    settings:
      authentication:
        plugin: basic
        username: fedoraAdmin
        password: fedoraAdmin
  uid: constants/creator_uid
destination:
  plugin: 'entity:file'
  default_bundle: file
migration_dependencies:
  required: { }
  optional: { }
